<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Born-Haber Cycle - Part 1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 100%;
            margin: 0 auto;
            padding: 10px 15px;
            background-color: #f5f5f5;
            box-sizing: border-box;
            -webkit-text-size-adjust: 100%;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            font-size: 1.6rem;
            margin: 10px 0;
        }
        .instructions {
            background-color: #eaf2f8;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 5px solid #3498db;
            text-align: center;
        }
        .instructions p {
            margin: 8px 0;
            font-size: 1.1rem;
            line-height: 1.4;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 15px;
            width: 100%;
            max-width: 1600px;
            margin-left: auto;
            margin-right: auto;
        }
        .source-heading {
            margin-bottom: 10px;
            color: #2c3e50;
            text-align: center;
        }
        .image-source {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            min-height: 80px;
        }
        .sequence-area {
            background-color: white;
            padding: 15px 5px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            overflow-x: auto;
            min-height: 480px;
            width: 100%;
            box-sizing: border-box;
            margin: 0 auto;
        }
        .image-item {
            width: 180px;
            height: 180px;
            margin: 10px;
            cursor: pointer;
            border: 2px solid #3498db;
            border-radius: 5px;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            background-color: white;
        }
        .image-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .sequence-box {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 240px;
            margin: 0 auto;
            flex-wrap: nowrap;
            min-width: max-content;
        }
        .drop-zone-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 5px;
            width: 100%;
            box-sizing: border-box;
        }
        .drop-zone {
            width: 180px;
            height: 180px;
            border: 2px dashed #3498db;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }
        .drop-zone.active {
            background-color: #d4e6f1;
        }
        .drop-zone.filled {
            border-style: solid;
            background-color: #eaf2f8;
            box-shadow: 0 3px 8px rgba(52, 152, 219, 0.3);
        }
        .button-container {
            text-align: center;
            margin-top: 20px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 0 5px 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        #feedback {
            margin: 15px 0;
            padding: 15px;
            border-radius: 5px;
            display: none;
            text-align: center;
        }
        #feedback.success {
            background-color: #d4edda;
            border-left: 5px solid #28a745;
        }
        #feedback.error {
            background-color: #f8d7da;
            border-left: 5px solid #dc3545;
        }
        .connector-arrow {
            font-size: 24px;
            color: #3498db;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
        }
        .box-header {
            margin-bottom: 10px;
            font-weight: bold;
            text-align: center;
            width: 100%;
            font-size: 16px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .sequence-box {
                justify-content: flex-start;
                padding-bottom: 10px;
            }
            .drop-zone {
                width: 130px;
                height: 130px;
            }
            .image-item {
                width: 120px;
                height: 120px;
            }
            h1 {
                font-size: 1.5rem;
            }
            .instructions p {
                font-size: 0.9rem;
            }
        }
        
        /* Make sure elements don't shrink too much on very small screens */
        @media (max-width: 400px) {
            .drop-zone {
                min-width: 120px;
                min-height: 120px;
            }
        }
        
        /* Selected image styling */
        .image-item.selected {
            border: 2px solid #e74c3c;
            box-shadow: 0 0 12px rgba(231, 76, 60, 0.6);
            transform: scale(1.05);
        }
        
        .sequence-heading {
            margin-bottom: 10px;
            color: #2c3e50;
            text-align: center;
        }
        
        /* Additional styles for the flowchart layout */
        .flowchart-sequence {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        
        .main-flow {
            display: flex;
            flex-direction: row;
            align-items: center;
            width: 100%;
            margin: 20px 0;
            justify-content: space-between;
            flex-wrap: nowrap;
            overflow-x: auto;
            padding: 20px 10px;
            min-height: 450px;
        }
        
        .horizontal-arrow {
            color: #3498db;
            font-size: 24px;
            margin: 0 10px;
            display: flex;
            align-items: center;
        }
        
        .vertical-split {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 10px;
            min-width: 600px;
            position: relative;
        }
        
        .atom-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }
        
        .ion-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            margin-left: 60px;
            position: relative;
            width: 260px;
        }
        
        .parallel-paths {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            width: 100%;
        }
        
        .cation-container {
            position: relative;
            right: 200px;
            z-index: 1;
        }
        
        /* Mobile adjustments for the flowchart */
        @media (max-width: 768px) {
            .main-flow {
                flex-direction: column;
                align-items: center;
                min-height: 900px;
                padding: 20px 0;
            }
            
            .horizontal-arrow {
                transform: rotate(90deg);
                margin: 10px 0;
            }
            
            .parallel-paths {
                flex-direction: column;
                gap: 20px;
                margin-top: 20px;
                margin-bottom: 20px;
            }
            
            .atom-column, .ion-column {
                gap: 20px;
            }
            
            .cation-container {
                right: 0;
                margin-bottom: 60px;
            }
            
            .vertical-split {
                min-width: 320px;
            }
            
            .sequence-area {
                min-height: 950px;
            }
        }
        
        /* Adjust for smaller screens */
        @media (max-width: 992px) {
            .vertical-split {
                min-width: 450px;
            }
            
            .drop-zone {
                width: 140px;
                height: 140px;
            }
            
            .cation-container {
                right: 150px;
            }
        }
        
        /* CSS changes for the grid layout */
        .flowchart-grid {
            display: grid;
            grid-template-columns: minmax(180px, 1fr) minmax(70px, 0.5fr) minmax(180px, 1fr) minmax(70px, 0.5fr) minmax(180px, 1fr) minmax(70px, 0.5fr) minmax(180px, 1fr);
            grid-template-rows: minmax(200px, 220px) 50px minmax(200px, 220px);
            justify-content: space-evenly;
            align-items: center;
            gap: 15px;
            margin: 0 auto;
            width: 98%;
            padding: 25px 30px;
            background-color: white;
            border-radius: 15px;
            box-sizing: border-box;
            max-width: 1400px;
        }
        
        /* Arrow styling - revert to text-based arrows */
        .arrow {
            font-size: 42px;
            color: #3498db;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            width: 100%;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            position: relative;
            /* Prevent iOS from converting arrows to emoji */
            -webkit-font-feature-settings: "liga" 0;
            font-feature-settings: "liga" 0;
            font-variant: normal;
        }
        
        .diagonal-up {
            transform: rotate(-5deg);
            font-size: 56px;
        }
        
        .diagonal-down {
            transform: rotate(5deg);
            font-size: 56px;
        }
        
        /* Simple horizontal arrows */
        .arrow[style*="grid-column: 4; grid-row: 1"],
        .arrow[style*="grid-column: 4; grid-row: 3"] {
            font-size: 64px;
            padding: 0 20px;
            width: calc(100% + 80px);
            margin-left: -60px;
            font-weight: bolder;
            text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.2);
        }
        
        /* Specifically target the top horizontal arrow that spans grid cells */
        .arrow[style*="grid-column: 4; grid-row: 1; grid-column-end: 6"] {
            font-size: 64px;
            width: calc(100% + 80px);
            margin-left: -60px;
            font-weight: bolder;
            text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.2);
        }
        
        /* Remove diagonal arrow alignment adjustments as they're not needed for text arrows */
        .arrow.diagonal-up[style*="grid-column: 2"] {
            transform: none;
            align-self: flex-end;
            padding-bottom: 0;
        }
        
        .arrow.diagonal-down[style*="grid-column: 2"] {
            transform: none;
            align-self: flex-start;
            padding-top: 0;
        }
        
        .arrow.diagonal-down[style*="grid-column: 7"] {
            transform: none;
            align-self: flex-end;
            padding-bottom: 0;
        }
        
        .arrow.diagonal-up[style*="grid-column: 7"] {
            transform: none;
            align-self: flex-start;
            padding-top: 0;
        }
        
        /* Animation adjustments for SVG arrows */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .arrow:hover svg {
            animation: none;
        }
        
        .sequence-area {
            overflow-x: visible;
            min-height: 450px;
            padding: 15px;
            margin: 0 auto;
        }
        
        /* Styles for iframe embedding */
        @media (max-width: 1000px) {
            body {
                padding: 5px 10px;
            }
            
            .container {
                max-width: 100%;
            }
            
            .sequence-area {
                padding: 8px;
                min-height: 380px;
            }
            
            .flowchart-grid {
                grid-template-columns: minmax(120px, 1fr) minmax(50px, 0.4fr) minmax(120px, 1fr) minmax(50px, 0.4fr) minmax(120px, 1fr) minmax(50px, 0.4fr) minmax(120px, 1fr);
                grid-template-rows: 140px 40px 140px;
                width: 100%;
                padding: 12px 15px;
                gap: 8px;
            }
            
            .drop-zone {
                width: 120px;
                height: 120px;
            }
        }
        
        /* When embedded in iframe */
        @media (max-height: 700px) {
            .flowchart-grid {
                grid-template-rows: 130px 40px 130px;
                padding: 10px;
            }
            
            .drop-zone {
                width: 120px;
                height: 120px;
            }
        }
        
        /* Mobile adjustments for the flowchart */
        @media (max-width: 768px) {
            .arrow.diagonal-up, 
            .arrow.diagonal-down {
                font-size: 32px;
                padding-right: 5px;
                padding-left: 5px;
            }
            
            /* Adjust horizontal arrows */
            .arrow svg {
                height: 16px;
            }
            
            .flowchart-grid {
                grid-template-columns: minmax(100px, 1fr) minmax(35px, 0.3fr) minmax(100px, 1fr) minmax(40px, 0.3fr) minmax(100px, 1fr) minmax(35px, 0.3fr) minmax(100px, 1fr);
                grid-template-rows: 120px 30px 120px;
                padding: 10px;
                gap: 6px;
            }
            
            .drop-zone {
                width: 100px;
                height: 100px;
            }
            
            .box-header {
                font-size: 12px;
                margin-bottom: 4px;
            }
        }
        
        /* Adjust progress arrow for smaller screens */
        @media (max-width: 600px) {
            .progress-arrow svg {
                height: 20px;
            }
            
            .progress-text {
                font-size: 12px;
            }
            
            .flowchart-grid {
                grid-template-columns: minmax(85px, 1fr) minmax(30px, 0.25fr) minmax(85px, 1fr) minmax(35px, 0.25fr) minmax(85px, 1fr) minmax(30px, 0.25fr) minmax(85px, 1fr);
                grid-template-rows: 100px 25px 100px;
                padding: 8px;
                gap: 4px;
            }
            
            .drop-zone {
                width: 85px;
                height: 85px;
                border-width: 1px;
            }
        }
        
        /* Small screen adjustments */
        @media (max-width: 850px) {
            h1 {
                font-size: 1.1rem;
                margin: 2px 0;
            }
            
            .instructions {
                padding: 8px 12px;
                margin-bottom: 10px;
            }
            
            .instructions p {
                font-size: 0.95rem;
                margin: 6px 0;
                line-height: 1.3;
            }
            
            .container {
                gap: 10px;
                margin-bottom: 10px;
            }
            
            /* Center the diagram in the iframe */
            .sequence-area, .flowchart-grid {
                margin-left: auto;
                margin-right: auto;
            }
            
            .progress-arrow {
                width: 95%;
            }
            
            .progress-text {
                font-size: 12px;
            }
            
            /* Arrow size adjustments for medium screens */
            .arrow {
                font-size: 36px;
            }
            
            .diagonal-up, .diagonal-down {
                font-size: 48px;
            }
            
            .arrow[style*="grid-column: 4; grid-row: 1"],
            .arrow[style*="grid-column: 4; grid-row: 3"],
            .arrow[style*="grid-column: 4; grid-row: 1; grid-column-end: 6"] {
                font-size: 54px;
                width: calc(100% + 30px);
                margin-left: -15px;
            }
            
            .arrow[style*="grid-column: 2; grid-row: 1"] {
                align-self: end;
                padding-bottom: 10px;
            }
            
            .arrow[style*="grid-column: 2; grid-row: 3"] {
                align-self: start;
                padding-top: 10px;
            }
            
            .arrow[style*="grid-column: 7; grid-row: 1"] {
                align-self: end;
                padding-bottom: 10px;
                padding-left: 8px;
            }
            
            .arrow[style*="grid-column: 7; grid-row: 3"] {
                align-self: start;
                padding-top: 10px;
                padding-left: 8px;
            }
            
            /* Adjust horizontal arrows */
            .arrow svg {
                height: 20px;
            }
            
            .button-container {
                margin-top: 10px;
            }
            
            button {
                padding: 8px 15px;
                font-size: 14px;
                margin: 0 5px 5px;
            }
        }
        
        @media (max-width: 768px) {
            /* Arrow size adjustments for small screens */
            .arrow {
                font-size: 32px;
            }
            
            .diagonal-up, .diagonal-down {
                font-size: 42px;
            }
            
            .arrow[style*="grid-column: 4; grid-row: 1"],
            .arrow[style*="grid-column: 4; grid-row: 3"],
            .arrow[style*="grid-column: 4; grid-row: 1; grid-column-end: 6"] {
                font-size: 48px;
                width: calc(100% + 20px);
                margin-left: -10px;
            }
        }
        
        @media (max-width: 600px) {
            /* Arrow size adjustments for very small screens */
            .arrow {
                font-size: 28px;
            }
            
            .diagonal-up, .diagonal-down {
                font-size: 36px;
            }
            
            .arrow[style*="grid-column: 4; grid-row: 1"],
            .arrow[style*="grid-column: 4; grid-row: 3"],
            .arrow[style*="grid-column: 4; grid-row: 1; grid-column-end: 6"] {
                font-size: 38px;
                width: calc(100% + 60px);
                margin-left: -50px;
                padding: 0;
            }
        }
        
        /* Canvas LMS specific adjustments */
        .canvas-lms-embedded {
            padding: 0 !important;
            margin: 0 !important;
            width: 100% !important;
            max-width: 100% !important;
        }

        /* Ensure the diagram fits within Canvas LMS iframe width */
        @media (max-width: 1100px) {
            body {
                padding: 5px 10px;
            }
            
            .container {
                max-width: 100%;
            }
            
            .sequence-area {
                padding: 10px;
                min-height: 420px;
            }
            
            .flowchart-grid {
                grid-template-columns: minmax(140px, 1fr) minmax(50px, 0.4fr) minmax(140px, 1fr) minmax(50px, 0.4fr) minmax(140px, 1fr) minmax(50px, 0.4fr) minmax(140px, 1fr);
                grid-template-rows: 160px 40px 160px;
                width: 100%;
                padding: 15px 18px;
                gap: 10px;
            }
            
            .drop-zone {
                width: 140px;
                height: 140px;
            }
        }
        
        @media (max-width: 850px) {
            .sequence-area {
                padding: 8px;
                min-height: 380px;
            }
            
            .flowchart-grid {
                grid-template-columns: minmax(120px, 1fr) minmax(40px, 0.3fr) minmax(120px, 1fr) minmax(45px, 0.35fr) minmax(120px, 1fr) minmax(40px, 0.3fr) minmax(120px, 1fr);
                grid-template-rows: 140px 35px 140px;
                padding: 12px 15px;
                gap: 8px;
            }
            
            .drop-zone {
                width: 120px;
                height: 120px;
            }
        }
        
        /* Right-side Ionic Compound adjustments */
        .drop-zone-container[style*="grid-column: 8"] {
            margin-right: 0;
            padding-right: 0;
            max-width: 180px;
        }
        
        /* Make sure grid container has enough width */
        .sequence-area {
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            overflow-x: auto;
            max-width: 100%;
            min-height: 360px;
            width: 100%;
            box-sizing: border-box;
        }
        
        /* Progress arrow below the flowchart */
        .progress-arrow-container {
            width: 100%;
            display: flex;
            justify-content: center;
            margin: 15px 0;
            position: relative;
            max-width: 1600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .progress-arrow {
            width: 100%;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .progress-arrow svg {
            width: 100%;
            height: 24px;
        }
        
        .progress-arrow svg line {
            stroke: #3498db;
            stroke-width: 3;
        }
        
        .progress-arrow svg polygon {
            fill: #3498db;
        }
        
        .progress-text {
            position: absolute;
            font-size: 18px;
            color: #2c3e50;
            font-weight: bold;
            text-align: center;
            width: 100%;
            top: 26px;
        }
    </style>
</head>
<body>
    <h1>Born-Haber Cycle - Part 1</h1>
    
    <div class="instructions">
        <p>In the Born-Haber Cycle, the formation of an ionic compound from its elements follows a specific pathway.</p>
        <p>Arrange the images in the correct sequence by dragging them into the boxes in the flowchart below. The process flows from left to right, with Elements splitting into parallel pathways before forming the final Ionic Compound.</p>
        <p>You'll need to determine which species belong in each unmarked position based on your understanding of the Born-Haber cycle. Click on two images to swap them, or click an image and then click on "Available Images" to return it. Click "Mark Answer" when you're done to check your sequence.</p>
    </div>
    
    <div class="container">
        <h3 class="source-heading">Available Images</h3>
        <div class="image-source" id="image-source">
            <div class="image-item" draggable="true" data-image="Gaseous anions.png" data-name="Gaseous anions">
                <img src="Gaseous anions.png" alt="Gaseous Anions">
            </div>
            <div class="image-item" draggable="true" data-image="Gaseous cations.png" data-name="Gaseous cations">
                <img src="Gaseous cations.png" alt="Gaseous cations">
            </div>
            <div class="image-item" draggable="true" data-image="Gaseous metal atoms.png" data-name="Gaseous metal atoms">
                <img src="Gaseous metal atoms.png" alt="Gaseous metal atoms">
            </div>
            <div class="image-item" draggable="true" data-image="Gaseous non-metal atoms.png" data-name="Gaseous non-metal atoms">
                <img src="Gaseous non-metal atoms.png" alt="Gaseous non-metal atoms">
            </div>
            <div class="image-item" draggable="true" data-image="Ionic compound.png" data-name="Ionic compound">
                <img src="Ionic compound.png" alt="Ionic compound">
            </div>
            <div class="image-item" draggable="true" data-image="Elements.png" data-name="Elements">
                <img src="Elements.png" alt="Elements">
            </div>
        </div>
        
        <div id="feedback"></div>
        
        <h3 class="sequence-heading">Arrange in Correct Sequence</h3>
        <div class="sequence-area">
            <div class="flowchart-grid" id="sequence-box">
                <!-- Elements (left column, spans both rows) -->
                <div class="drop-zone-container" style="grid-column: 1; grid-row: 1 / span 3; align-self: center;">
                    <div class="box-header">Elements</div>
                    <div class="drop-zone" data-position="1"></div>
                </div>
                
                <!-- Diagonal arrow going up -->
                <div class="arrow diagonal-up" style="grid-column: 2; grid-row: 1;">&#8599;</div>
                
                <!-- Diagonal arrow going down -->
                <div class="arrow diagonal-down" style="grid-column: 2; grid-row: 3;">&#8600;</div>
                
                <!-- Top atoms box -->
                <div class="drop-zone-container" style="grid-column: 3; grid-row: 1;">
                    <div class="drop-zone" data-position="2"></div>
                </div>
                
                <!-- Empty space for better layout -->
                <div style="grid-column: 3; grid-row: 2;"></div>
                
                <!-- Bottom atoms box -->
                <div class="drop-zone-container" style="grid-column: 3; grid-row: 3;">
                    <div class="drop-zone" data-position="3"></div>
                </div>
                
                <!-- Bottom horizontal arrow -->
                <div class="arrow" style="grid-column: 4; grid-row: 3;">&#8594;</div>
                
                <!-- Bottom ions box -->
                <div class="drop-zone-container" style="grid-column: 5; grid-row: 3;">
                    <div class="drop-zone" data-position="5"></div>
                </div>
                
                <!-- Top horizontal arrow - only one arrow -->
                <div class="arrow" style="grid-column: 4; grid-row: 1; grid-column-end: 6;">&#8594;</div>
                
                <!-- Top ions box (shifted left) -->
                <div class="drop-zone-container" style="grid-column: 6; grid-row: 1;">
                    <div class="drop-zone" data-position="4"></div>
                </div>
                
                <!-- Diagonal converging arrow from top (adjusted) -->
                <div class="arrow diagonal-down" style="grid-column: 7; grid-row: 1;">&#8600;</div>
                
                <!-- Diagonal converging arrow from bottom (adjusted) -->
                <div class="arrow diagonal-up" style="grid-column: 7; grid-row: 3;">&#8599;</div>
                
                <!-- Ionic compound (right column, spans both rows, adjusted) -->
                <div class="drop-zone-container" style="grid-column: 8; grid-row: 1 / span 3; align-self: center;">
                    <div class="box-header">Ionic<br>Compound</div>
                    <div class="drop-zone" data-position="6"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="progress-arrow-container">
        <div class="progress-arrow">
            <svg viewBox="0 0 600 24">
                <line x1="10" y1="12" x2="590" y2="12" stroke="#3498db" stroke-width="3" />
                <polygon points="590,12 580,7 580,17" fill="#3498db" stroke="#3498db" />
            </svg>
            <div class="progress-text">
                <span>Process</span>
            </div>
        </div>
    </div>
    
<br>

    <div class="button-container">
        <button id="check-btn">Mark Answer</button>
        <button id="reset-btn">Reset</button>
    </div>
    
    <script>
        // Store the current sequence as the images are arranged
        let currentSequence = [null, null, null, null, null, null];
        
        document.addEventListener('DOMContentLoaded', function() {
            const imageItems = document.querySelectorAll('.image-item');
            const dropZones = document.querySelectorAll('.drop-zone');
            const imageSource = document.getElementById('image-source');
            const checkButton = document.getElementById('check-btn');
            const resetButton = document.getElementById('reset-btn');
            const feedbackDiv = document.getElementById('feedback');
            let selectedItem = null;
            
            // Set internal IDs for tracking purposes (not visible to users)
            let imageId = 1;
            imageItems.forEach(item => {
                item.dataset.id = imageId++;
                // Remove draggable attribute
                item.removeAttribute('draggable');
            });
            
            // Set up click handlers for images
            imageItems.forEach(item => {
                item.addEventListener('click', handleImageClick);
            });
            
            // Set up click handlers for drop zones
            dropZones.forEach(zone => {
                zone.addEventListener('click', handleZoneClick);
            });
            
            // Add click handler to the image source container
            imageSource.addEventListener('click', function(e) {
                // Only act if clicking directly on the container (not on an image)
                if (e.target === this && selectedItem) {
                    // Return the selected item to the image source
                    const currentParent = selectedItem.parentNode;
                    
                    // If coming from a drop zone, update the sequence
                    if (currentParent.classList.contains('drop-zone')) {
                        const position = parseInt(currentParent.dataset.position) - 1;
                        currentSequence[position] = null;
                        currentParent.classList.remove('filled');
                    }
                    
                    // Move the item back to source
                    imageSource.appendChild(selectedItem);
                    selectedItem.classList.remove('selected');
                    selectedItem = null;
                }
            });
            
            // Click to select an image
            function handleImageClick(e) {
                e.stopPropagation();
                
                // If this is a second click on the same item, deselect it
                if (selectedItem === this) {
                    selectedItem.classList.remove('selected');
                    selectedItem = null;
                    return;
                }
                
                // If there's already a selected item, handle swapping
                if (selectedItem) {
                    const firstItem = selectedItem;
                    const secondItem = this;
                    
                    // Get the parent elements
                    const firstParent = firstItem.parentNode;
                    const secondParent = secondItem.parentNode;
                    
                    // Remove selection styling
                    firstItem.classList.remove('selected');
                    
                    // Handle the swap
                    swapItems(firstItem, secondItem, firstParent, secondParent);
                    
                    selectedItem = null;
                    return;
                }
                
                // Select this item
                selectedItem = this;
                this.classList.add('selected');
            }
            
            // Click on a drop zone to place the selected image
            function handleZoneClick(e) {
                e.stopPropagation();
                
                // Only respond to clicks directly on the zone, not on contained images
                if (e.target !== this || !selectedItem) return;
                
                const existingImage = this.querySelector('.image-item');
                const selectedParent = selectedItem.parentNode;
                
                // Handle the placement/swap
                if (existingImage) {
                    swapItems(selectedItem, existingImage, selectedParent, this);
                } else {
                    // Simple placement if zone is empty
                    this.appendChild(selectedItem);
                    this.classList.add('filled');
                    
                    // Update sequence if coming from another drop zone
                    if (selectedParent.classList.contains('drop-zone')) {
                        const oldPosition = parseInt(selectedParent.dataset.position) - 1;
                        currentSequence[oldPosition] = null;
                        selectedParent.classList.remove('filled');
                    }
                    
                    // Update sequence for new position
                    const newPosition = parseInt(this.dataset.position) - 1;
                    currentSequence[newPosition] = selectedItem.dataset.id;
                }
                
                selectedItem.classList.remove('selected');
                selectedItem = null;
            }
            
            // Helper function to handle swapping items
            function swapItems(firstItem, secondItem, firstParent, secondParent) {
                // Store original positions
                const firstPosition = firstParent.classList.contains('drop-zone') ? 
                    parseInt(firstParent.dataset.position) - 1 : null;
                const secondPosition = secondParent.classList.contains('drop-zone') ? 
                    parseInt(secondParent.dataset.position) - 1 : null;
                
                // Perform the swap
                if (firstParent.classList.contains('drop-zone')) {
                    firstParent.classList.remove('filled');
                }
                if (secondParent.classList.contains('drop-zone')) {
                    secondParent.classList.remove('filled');
                }
                
                // Move items
                if (firstPosition !== null) {
                    secondParent.appendChild(firstItem);
                    secondParent.classList.add('filled');
                } else {
                    imageSource.appendChild(firstItem);
                }
                
                if (secondPosition !== null) {
                    firstParent.appendChild(secondItem);
                    firstParent.classList.add('filled');
                } else {
                    imageSource.appendChild(secondItem);
                }
                
                // Update sequence array
                if (firstPosition !== null) {
                    currentSequence[firstPosition] = secondItem ? secondItem.dataset.id : null;
                }
                if (secondPosition !== null) {
                    currentSequence[secondPosition] = firstItem ? firstItem.dataset.id : null;
                }
            }
            
            // Check the answer when the button is clicked
            checkButton.addEventListener('click', function() {
                // Check if all positions are filled
                if (currentSequence.includes(null)) {
                    showFeedback("Please fill all positions in the sequence.", false);
                    feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return;
                }
                
                // Get all the images in the sequence
                const sequenceImages = [];
                for (let i = 0; i < currentSequence.length; i++) {
                    const imageId = currentSequence[i];
                    const image = document.querySelector(`[data-id="${imageId}"]`);
                    sequenceImages.push(image);
                }
                
                // Check the sequence according to the specified rules order
                let isCorrect = true;
                let feedback = "";
                
                // Rule 1: Check if Elements is at the start
                if (sequenceImages[0].dataset.name !== "Elements") {
                    isCorrect = false;
                    feedback = "Elements should be at the start of the sequence as this is the initial state in the Born-Haber cycle.";
                }
                // Rule 2: Check if Ionic compound is at the end
                else if (sequenceImages[5].dataset.name !== "Ionic compound") {
                    isCorrect = false;
                    feedback = "Ionic compound should be at the end of the sequence as this is the final product of the Born-Haber cycle.";
                }
                // Rule 3: Check if ions come before atoms
                else if ((sequenceImages[1].dataset.name === "Gaseous anions" || sequenceImages[1].dataset.name === "Gaseous cations") ||
                         (sequenceImages[2].dataset.name === "Gaseous anions" || sequenceImages[2].dataset.name === "Gaseous cations")) {
                    isCorrect = false;
                    feedback = "Ions have to come after atoms in the reaction sequence. Atoms must be created first before they can gain or lose electrons.";
                }
                // Rule 4: Check if metal atoms go to the top row
                else if (sequenceImages[1].dataset.name === "Gaseous metal atoms") {
                    isCorrect = false;
                    feedback = "Think about which atom should be converted to ions first. Metal atoms should be placed in the bottom row because electrons have to be produced first.";
                }
                // Rule 5: Check if metal ions go above (after non-metal ions)
                else if (sequenceImages[3].dataset.name === "Gaseous cations" && sequenceImages[4].dataset.name === "Gaseous anions") {
                    isCorrect = false;
                    feedback = "Electrons have to be produced first. Metal atoms lose electrons to form cations, which must happen before non-metal atoms can gain electrons to form anions.";
                }
                // If all above rules pass, check the standard positions
                else if (sequenceImages[1].dataset.name !== "Gaseous non-metal atoms") {
                    isCorrect = false;
                    feedback = "The top position in the atoms column should contain gaseous non-metal atoms. Think about which atom should be converted to ions first.";
                }
                else if (sequenceImages[2].dataset.name !== "Gaseous metal atoms") {
                    isCorrect = false;
                    feedback = "The bottom position in the atoms column should contain gaseous metal atoms. Think about which atom should be converted to ions first.";
                }
                else if (sequenceImages[3].dataset.name !== "Gaseous anions") {
                    isCorrect = false;
                    feedback = "Gaseous anions should be in the top position of the ions column. Non-metal atoms gain electrons to form anions. Electrons have to be produced first before they can be taken in to form anions.";
                }
                else if (sequenceImages[4].dataset.name !== "Gaseous cations") {
                    isCorrect = false;
                    feedback = "Gaseous cations should be in the bottom position of the ions column. Metal atoms lose electrons to form cations. Electrons have to be produced first.";
                }
                
                // Display appropriate feedback
                if (isCorrect) {
                    showFeedback("Congratulations! Your sequence is correct.", true);
                } else {
                    showFeedback(feedback, false);
                }
                
                // Scroll to the feedback
                feedbackDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
            
            // Reset the sequence
            resetButton.addEventListener('click', function() {
                // Move all images back to the source
                dropZones.forEach(zone => {
                    const image = zone.querySelector('.image-item');
                    if (image) {
                        imageSource.appendChild(image);
                        zone.classList.remove('filled');
                    }
                });
                
                // Reset the sequence array
                currentSequence = [null, null, null, null, null, null];
                
                // Deselect any selected item
                if (selectedItem) {
                    selectedItem.classList.remove('selected');
                    selectedItem = null;
                }
                
                // Hide feedback
                feedbackDiv.style.display = 'none';
            });
            
            // Display feedback to the user
            function showFeedback(message, isSuccess) {
                feedbackDiv.textContent = message;
                feedbackDiv.style.display = 'block';
                
                if (isSuccess) {
                    feedbackDiv.className = 'success';
                } else {
                    feedbackDiv.className = 'error';
                }
            }
        });
    </script>
</body>
</html>
